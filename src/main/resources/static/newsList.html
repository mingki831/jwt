<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Title</title>

    <style>
        tr {
            border: 1px solid #444444;
        }

        th {
            border: 1px solid #444444;
        }

        td {
            border: 1px solid #444444;
        }

    </style>
    <script>
        $(document).ready(function () {
            // 1. 뉴스 리스트 조회
            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: "http://localhost:8080/api/news/all",
                dataType: 'json',
                success: function (response) {
                    let list = response.data;
                    let htmlArr = [];
                    for (let i = 0, length = list.length; i < length; i++) {
                        let item = list[i];
                        htmlArr.push('<tr>');
                        htmlArr.push('<td class="employee" data-id="' + item.id + '">');
                        htmlArr.push('<input type="checkbox" class="newsChoice" id="newsChoice' + item.id + '" value="' + item.id + '">');
                        // htmlArr.push('<input type="submit" value="수정" class="newsUpdate" id="newsUpdate' + item.id + '" value="' + item.id + '">');
                        htmlArr.push('<label class="news" data-id="' + item.id + '">' + item.message + '</label>'); +
                        htmlArr.push('<label class="news" data-id="' + item.id + '">' + item.author + '</label>');
                        htmlArr.push('</td>');
                        // htmlArr.push('<label class="news" data-id="' + item.id + '">' + item.author + '</label>');
                        htmlArr.push('</tr>');
                    }

                    $('#tbodyNews').html(htmlArr.join(''));
                    console.log(response);

                },
                error: function (e) {
                    alert("Error: " + e.responseText);
                }
            });
        });


        // 체크하면 뉴스 지정
        let selectedEmployeeId = [];

        $(document).on('click', '.news', function () {
            let newsId = $(this).val();
            if ($(this).is(':checked')) {
                selectedEmployeeId.push(newsId);
            } else {
                selectedEmployeeId = selectedEmployeeId.filter(id => id !== newsId);
                $('#news' + employeeId).prop('checked', false);
            }
            updateNewsTable();
        });

        function updateNewsTable() {
            if (selectedEmployeeId.length === 0) {
                return;
            }

            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "http://localhost:8080/api/news/choice/" + selectedEmployeeId.join(','),
                dataType: 'json',
                success: function (response) {
                    if (response.success === true) {
                        console.log(response);
                    }
                },
                error: function (e) {
                    alert("Error: " + e.responseText);
                }
            });
        }

        // 뉴스 수정

        $(document).ready(function() {
            $("#newsUpdateForm").submit(function(event) {
                event.preventDefault(); // 폼 전송 방지

                const formData = {
                    // news: '1',
                    author: $("#author").val(),
                    message: $("#message").val(),
                };

                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "http://localhost:8080/api/news/update" + $(this).attr('data-id'),
                    data: JSON.stringify(formData),
                    dataType: 'json',
                    success: function(response) {
                        if (response.success === true) {
                            alert('수정완료');
                            window.location.href = 'http://localhost:8080/newsList.html';
                        } else {
                            alert('실패');
                        }
                    },
                    error: function(e) {
                        alert("Error: " + e.responseText);
                    }
                });
            });
        });

    </script>


</head>
<body>

<table>
    <thead>
    <tr>
        <th>뉴스게시판</th>
    </tr>
    </thead>
    <tbody id="tbodyNews">
    <a href="newsRegister.html"><input type="button" value="뉴스 등록하기"></a>
    </tbody>

</table>

<!--    뉴스 수정폼-->
    <form id="newsUpdateForm">
        <label for="author">Author:</label>
        <input type="text" id="author" name="author"><br>
        <label for="message">Message:</label>
        <input type="text" id="message" name="message"><br>

        <button id="btn-newsUpdate-save" class="btn btn-primary">수정</button>

</body>
</html>