<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <meta charset="UTF-8">
    <title>직원리스트</title>

    <script>

        $(document).ready(function () {
            // 1. 상위부서 리스트 조회
            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: "http://localhost:8080/api/divisions/all",
                dataType: 'json',
                success: function (response) {
                    let list = response.data;
                    let htmlArr = [];
                    for (let i = 0, length = list.length; i < length; i++) {
                        let item = list[i];
                        htmlArr.push('<tr>');
                        htmlArr.push('<td class="division" data-id="' + item.id + '">' + item.division + '</td>');
                        htmlArr.push('</tr>');

                    }
                    $('#tbodyDivision').html(htmlArr.join(''));
                    console.log(response);

                    // 2. 상위부서 클릭 시 하위부서 리스트 조회
                    $(document).on('click', '.division', function () {
                        $.ajax({
                            type: "GET",
                            contentType: "application/json; charset=utf-8",
                            url: "http://localhost:8080/api/divisions/" + $(this).attr('data-id'),
                            dataType: 'json',
                            success: function (response) {
                                let list = response.data;
                                let htmlArr = [];
                                for (let i = 0, length = list.department.length; i < length; i++) {
                                    let item = list.department[i];
                                    htmlArr.push('<tr>');
                                    htmlArr.push('<td class="department" data-id="' + item.id + '">');
                                    htmlArr.push('<label for="department' + item.id + '">' + item.department + '</label>');
                                    htmlArr.push('</td>');
                                    htmlArr.push('</tr>');
                                }

                                $('#tbodyDepartment').html(htmlArr.join(''));
                                console.log(response);
                            },
                            error: function (e) {
                                alert("Error: " + e.responseText);
                            }
                        });
                    });
                },
                error: function (e) {
                    alert("Error: " + e.responseText);
                }
            });
        });

    </script>


</head>
<body>

<table>
    <tr>
        <td>
            <table>
                <thead>
                <tr>
                    <th>상위부서</th>
                </tr>
                </thead>
                <tbody id="tbodyDivision">
                </tbody>
            </table>
        </td>
        <td>
            <table>
                <thead>
                <tr>
                    <th>하위부서</th>
                </tr>
                </thead>
                <tbody id="tbodyDepartment">
                </tbody>
            </table>
        </td>
        <td>
            <table>
                <thead>
                <tr>
                    <th>직원</th>
                </tr>
                </thead>
                <tbody id="tbodyEmployee">
                </tbody>
            </table>
        </td>
        <td>
            <table>
                <thead>
                <tr>
                    <th>리더</th>
                </tr>
                </thead>
                <tbody id="tbodyLeader">
                </tbody>
            </table>
        </td>
    </tr>
</table>
</body>
</html>